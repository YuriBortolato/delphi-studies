unit uPrincipal;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Layouts,
  FMX.StdCtrls, FMX.Controls.Presentation, FMX.Objects, FMX.TabControl,
  uDesconto;

type
  TForm1 = class(TForm)
    lblTotal: TLabel;
    TabControl1: TTabControl;
    TabGerencial: TTabItem;

    // --- SCROLLBOXES (Renomeie no Design se der erro!) ---
    VertScrollBoxGastro: TVertScrollBox;
    VertScrollBoxGerencial: TVertScrollBox;

    // --- COMPONENTES GASTRONÔMICO (Só Checkboxes) ---
    chkMesa: TCheckBox;
    chkEntrega: TCheckBox;
    chkFiscal: TCheckBox;
    chkGerencePlus: TCheckBox;
    chkWhatsapp: TCheckBox;
    chkComeraqui: TCheckBox;
    chkFinanceiro: TCheckBox;
    chkDre: TCheckBox;
    chkDashboard: TCheckBox;
    chkIfood: TCheckBox;
    chkAiqfome: TCheckBox;
    chkDeliveryDireto: TCheckBox;

    lblQtdTerminais: TLabel;
    btnMenos: TRectangle;
    btnMais: TLabel;

    // --- COMPONENTES GERENCIAL (Só Checkboxes) ---
    chkFiscalGerencial: TCheckBox;
    chkFinanceiroGerencial: TCheckBox;
    chkDreGerencial: TCheckBox;
    chkDashboardGerencial: TCheckBox;
    chkGerenceRep: TCheckBox;

    lblQtdTerminaisGerencial: TLabel;
    btnMenosGerencial: TRectangle;
    btnMaisGerencial: TRectangle;

    // Eventos
    procedure FormCreate(Sender: TObject);
    procedure CalcularEvent(Sender: TObject);
    procedure TabControl1Change(Sender: TObject);

    // Botões Gastro
    procedure btnMaisClick(Sender: TObject);
    procedure btnMenosClick(Sender: TObject);

    // Botões Gerencial
    procedure btnMaisGerencialClick(Sender: TObject);
    procedure btnMenosGerencialClick(Sender: TObject);

  private
    FQtdTerminaisGastro: Integer;
    FQtdTerminaisGerencial: Integer;

    procedure CalcularTudo;
    function CalcularGastronomico: Currency;
    function CalcularGerencial: Currency;
  public
  end;

var
  Form1: TForm1;

implementation

{$R *.fmx}

// ============================================================================
// CONFIGURAÇÕES DE PREÇOS
// ============================================================================
const
  BASE_GASTRO = 127.00;
  MIN_TERM_GASTRO = 3;

  BASE_GERENCIAL = 180.00;
  MIN_TERM_GERENCIAL = 1;

  VALOR_EXTRA_TERMINAL = 17.00;

procedure TForm1.FormCreate(Sender: TObject);
begin
  FQtdTerminaisGastro := MIN_TERM_GASTRO;
  FQtdTerminaisGerencial := MIN_TERM_GERENCIAL;

  if Assigned(lblQtdTerminais) then
    lblQtdTerminais.Text := FQtdTerminaisGastro.ToString;

  if Assigned(lblQtdTerminaisGerencial) then
    lblQtdTerminaisGerencial.Text := FQtdTerminaisGerencial.ToString;

  TabControl1.ActiveTab := TabGastronomico;
  CalcularTudo;
end;

procedure TForm1.CalcularTudo;
var
  TotalFinal: Currency;
begin
  if TabControl1.ActiveTab = TabGerencial then
    TotalFinal := CalcularGerencial
  else
    TotalFinal := CalcularGastronomico;

  if Assigned(lblTotal) then
    lblTotal.Text := FormatFloat('R$ #,##0.00 | mês', TotalFinal);
end;

function TForm1.CalcularGastronomico: Currency;
var
  Total: Currency;
begin
  Total := 0;

  if FQtdTerminaisGastro <= MIN_TERM_GASTRO then
    Total := BASE_GASTRO
  else
    Total := BASE_GASTRO + ((FQtdTerminaisGastro - MIN_TERM_GASTRO) * VALOR_EXTRA_TERMINAL);

  if Assigned(chkMesa) and chkMesa.IsChecked           then Total := Total + 17.00;
  if Assigned(chkEntrega) and chkEntrega.IsChecked        then Total := Total + 17.00;
  if Assigned(chkFiscal) and chkFiscal.IsChecked         then Total := Total + 47.00;
  if Assigned(chkGerencePlus) and chkGerencePlus.IsChecked    then Total := Total + 47.00;
  if Assigned(chkWhatsapp) and chkWhatsapp.IsChecked       then Total := Total + 47.00;
  if Assigned(chkComeraqui) and chkComeraqui.IsChecked      then Total := Total + 47.00;
  if Assigned(chkFinanceiro) and chkFinanceiro.IsChecked     then Total := Total + 27.00;
  if Assigned(chkDre) and chkDre.IsChecked            then Total := Total + 27.00;
  if Assigned(chkDashboard) and chkDashboard.IsChecked      then Total := Total + 27.00;
  if Assigned(chkIfood) and chkIfood.IsChecked          then Total := Total + 27.00;
  if Assigned(chkAiqfome) and chkAiqfome.IsChecked        then Total := Total + 27.00;
  if Assigned(chkDeliveryDireto) and chkDeliveryDireto.IsChecked then Total := Total + 17.00;

  Result := Total;
end;

function TForm1.CalcularGerencial: Currency;
var
  Total: Currency;
begin
  Total := 0;

  if FQtdTerminaisGerencial <= MIN_TERM_GERENCIAL then
    Total := BASE_GERENCIAL
  else
    Total := BASE_GERENCIAL + ((FQtdTerminaisGerencial - MIN_TERM_GERENCIAL) * VALOR_EXTRA_TERMINAL);

  // Note: Usando Assigned para evitar erro se o componente não existir (segurança extra)
  if Assigned(chkFiscalGerencial) and chkFiscalGerencial.IsChecked     then Total := Total + 47.00;
  if Assigned(chkFinanceiroGerencial) and chkFinanceiroGerencial.IsChecked then Total := Total + 27.00;
  if Assigned(chkDreGerencial) and chkDreGerencial.IsChecked        then Total := Total + 27.00;
  if Assigned(chkDashboardGerencial) and chkDashboardGerencial.IsChecked  then Total := Total + 27.00;
  if Assigned(chkGerenceRep) and chkGerenceRep.IsChecked          then Total := Total + 47.00;

  Result := Total;
end;

procedure TForm1.TabControl1Change(Sender: TObject);
begin
  CalcularTudo;
end;

procedure TForm1.CalcularEvent(Sender: TObject);
begin
  CalcularTudo;
end;

procedure TForm1.btnMaisClick(Sender: TObject);
begin
  Inc(FQtdTerminaisGastro);
  lblQtdTerminais.Text := FQtdTerminaisGastro.ToString;
  CalcularTudo;
end;

procedure TForm1.btnMenosClick(Sender: TObject);
begin
  if FQtdTerminaisGastro > MIN_TERM_GASTRO then
  begin
    Dec(FQtdTerminaisGastro);
    lblQtdTerminais.Text := FQtdTerminaisGastro.ToString;
    CalcularTudo;
  end;
end;

procedure TForm1.btnMaisGerencialClick(Sender: TObject);
begin
  Inc(FQtdTerminaisGerencial);
  lblQtdTerminaisGerencial.Text := FQtdTerminaisGerencial.ToString;
  CalcularTudo;
end;

procedure TForm1.btnMenosGerencialClick(Sender: TObject);
begin
  if FQtdTerminaisGerencial > MIN_TERM_GERENCIAL then
  begin
    Dec(FQtdTerminaisGerencial);
    lblQtdTerminaisGerencial.Text := FQtdTerminaisGerencial.ToString;
    CalcularTudo;
  end;
end;

end.
