unit uPrincipal;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Layouts,
  FMX.StdCtrls, FMX.Controls.Presentation, FMX.Objects, FMX.TabControl,
  uDesconto;

type
  TForm1 = class(TForm)
    lblTotal: TLabel;
    TabControl1: TTabControl;
    TabGerencial: TTabItem; chkMesa: TCheckBox; chkEntrega: TCheckBox;
    LayoutFiscal: TLayout; chkFiscal: TCheckBox; chkGerencePlus: TCheckBox; chkWhatsapp: TCheckBox; chkComeraqui: TCheckBox;
    LayoutFinanceiro: TLayout; chkFinanceiro: TCheckBox;
    LayoutDre: TLayout; chkDre: TCheckBox;
    LayoutDashboard: TLayout; chkDashboard: TCheckBox; chkIfood: TCheckBox; chkAiqfome: TCheckBox; chkDeliveryDireto: TCheckBox;
    lblQtdTerminais: TLabel;
    btnMenos: TRectangle;
    btnMais: TLabel; chkFiscalGerencial: TCheckBox; chkFinanceiroGerencial: TCheckBox; chkDreGerencial: TCheckBox; chkDashboardGerencial: TCheckBox;
    LayoutGerenceRep: TLayout; chkGerenceRep: TCheckBox; // Layout dos terminais do gerencial
    lblQtdTerminaisGerencial: TLabel;
    btnMenosGerencial: TRectangle;
    btnMaisGerencial: TRectangle;

    // Eventos
    procedure FormCreate(Sender: TObject);
    procedure CalcularEvent(Sender: TObject);
    procedure TabControl1Change(Sender: TObject);

    // Botões Gastro
    procedure btnMaisClick(Sender: TObject);
    procedure btnMenosClick(Sender: TObject);

    // Botões Gerencial (Novos)
    procedure btnMaisGerencialClick(Sender: TObject);
    procedure btnMenosGerencialClick(Sender: TObject);

  private
    FQtdTerminaisGastro: Integer;
    FQtdTerminaisGerencial: Integer;

    procedure CalcularTudo;
    function CalcularGastronomico: Currency;
    function CalcularGerencial: Currency;
  public
  end;

var
  Form1: TForm1;

implementation

{$R *.fmx}

// ============================================================================
// CONFIGURAÇÕES DE PREÇOS (Fácil de alterar se o chefe pedir)
// ============================================================================
const
  // Regras Gastronômico
  BASE_GASTRO = 127.00;
  MIN_TERM_GASTRO = 3;

  // Regras Gerencial
  BASE_GERENCIAL = 180.00;
  MIN_TERM_GERENCIAL = 1;

  // Preço Extra por Terminal (Igual para os dois?)
  VALOR_EXTRA_TERMINAL = 17.00;

procedure TForm1.FormCreate(Sender: TObject);
begin
  // Inicia as contagens com o mínimo de cada um
  FQtdTerminaisGastro := MIN_TERM_GASTRO;
  FQtdTerminaisGerencial := MIN_TERM_GERENCIAL;

  // Atualiza labels visuais
  lblQtdTerminais.Text := FQtdTerminaisGastro.ToString;
  lblQtdTerminaisGerencial.Text := FQtdTerminaisGerencial.ToString;

  // Garante que começa na primeira aba
  TabControl1.ActiveTab := TabGastronomico;

  CalcularTudo;
end;

// ============================================================================
// LÓGICA DE CÁLCULO
// ============================================================================

procedure TForm1.CalcularTudo;
var
  TotalFinal: Currency;
begin
  // Decide qual conta fazer baseado na aba que está aberta
  if TabControl1.ActiveTab = TabGerencial then
    TotalFinal := CalcularGerencial
  else
    TotalFinal := CalcularGastronomico;

  // Exibe o Total lá em cima
  lblTotal.Text := FormatFloat('R$ #,##0.00 | mês', TotalFinal);
end;

function TForm1.CalcularGastronomico: Currency;
var
  Total: Currency;
begin
  Total := 0;

  // 1. Cálculo dos Terminais (Regra: Mínimo 3 por R$ 127)
  if FQtdTerminaisGastro <= MIN_TERM_GASTRO then
    Total := BASE_GASTRO
  else
    Total := BASE_GASTRO + ((FQtdTerminaisGastro - MIN_TERM_GASTRO) * VALOR_EXTRA_TERMINAL);

  // 2. Soma os Módulos (Preços definidos aqui no código)
  if chkMesa.IsChecked           then Total := Total + 17.00;
  if chkEntrega.IsChecked        then Total := Total + 17.00;
  if chkFiscal.IsChecked         then Total := Total + 47.00;
  if chkGerencePlus.IsChecked    then Total := Total + 47.00;
  if chkWhatsapp.IsChecked       then Total := Total + 47.00; // Ajuste se necessário
  if chkComeraqui.IsChecked      then Total := Total + 47.00;
  if chkFinanceiro.IsChecked     then Total := Total + 27.00;
  if chkDre.IsChecked            then Total := Total + 27.00;
  if chkDashboard.IsChecked      then Total := Total + 27.00;
  if chkIfood.IsChecked          then Total := Total + 27.00;
  if chkAiqfome.IsChecked        then Total := Total + 27.00;
  if chkDeliveryDireto.IsChecked then Total := Total + 17.00;

  Result := Total;
end;

function TForm1.CalcularGerencial: Currency;
var
  Total: Currency;
begin
  Total := 0;

  // 1. Cálculo dos Terminais (Regra: Mínimo 1 por R$ 180)
  if FQtdTerminaisGerencial <= MIN_TERM_GERENCIAL then
    Total := BASE_GERENCIAL
  else
    Total := BASE_GERENCIAL + ((FQtdTerminaisGerencial - MIN_TERM_GERENCIAL) * VALOR_EXTRA_TERMINAL);

  // 2. Soma os Módulos do Gerencial
  if chkFiscalGerencial.IsChecked     then Total := Total + 47.00;
  if chkFinanceiroGerencial.IsChecked then Total := Total + 27.00;
  if chkDreGerencial.IsChecked        then Total := Total + 27.00;
  if chkDashboardGerencial.IsChecked  then Total := Total + 27.00;
  if chkGerenceRep.IsChecked          then Total := Total + 47.00; // Chutei 47, confirme o valor!

  Result := Total;
end;

// ============================================================================
// EVENTOS DE INTERFACE
// ============================================================================

// Quando troca de aba (Gastro <-> Gerencial)
procedure TForm1.TabControl1Change(Sender: TObject);
begin
  CalcularTudo;
end;

// Checkboxes (Todos devem apontar para este evento no Object Inspector)
procedure TForm1.CalcularEvent(Sender: TObject);
begin
  CalcularTudo;
end;

// --- BOTÕES DO GASTRONÔMICO ---
procedure TForm1.btnMaisClick(Sender: TObject);
begin
  Inc(FQtdTerminaisGastro);
  lblQtdTerminais.Text := FQtdTerminaisGastro.ToString;
  CalcularTudo;
end;

procedure TForm1.btnMenosClick(Sender: TObject);
begin
  if FQtdTerminaisGastro > MIN_TERM_GASTRO then
  begin
    Dec(FQtdTerminaisGastro);
    lblQtdTerminais.Text := FQtdTerminaisGastro.ToString;
    CalcularTudo;
  end;
end;

// --- BOTÕES DO GERENCIAL (NOVOS) ---
procedure TForm1.btnMaisGerencialClick(Sender: TObject);
begin
  Inc(FQtdTerminaisGerencial);
  lblQtdTerminaisGerencial.Text := FQtdTerminaisGerencial.ToString;
  CalcularTudo;
end;

procedure TForm1.btnMenosGerencialClick(Sender: TObject);
begin
  if FQtdTerminaisGerencial > MIN_TERM_GERENCIAL then
  begin
    Dec(FQtdTerminaisGerencial);
    lblQtdTerminaisGerencial.Text := FQtdTerminaisGerencial.ToString;
    CalcularTudo;
  end;
end;

end.
