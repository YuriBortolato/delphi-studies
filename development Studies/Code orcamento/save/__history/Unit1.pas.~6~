unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls;

type
  TForm1 = class(TForm)
    pnlHeader: TPanel;
    sbModulos: TScrollBox;
    pnlRowMesa: TPanel;
    pnlRowEntrega: TPanel;
    pnlRowFiscal: TPanel;
    pnlRowGerencePlus: TPanel;
    Panel2: TPanel;
    pnlRowComeraqui: TPanel;
    pnlRowFinanceiro: TPanel;
    pnlRowDre: TPanel;
    pnlRowDashboard: TPanel;
    pnlRowIfood: TPanel;
    pnlRowAiqfome: TPanel;
    pnlRowDeliveryDireto: TPanel;
    pnlRowGerenceRep: TPanel;
    pnlRowTerminal: TPanel;
    lblTotal: TLabel;

    chkMesaEBalcao: TCheckBox;
    chkEntrega: TCheckBox;
    chkFiscal: TCheckBox;
    chkGerencePlus: TCheckBox;
    chkWhatsapp: TCheckBox;
    chkComeraqui: TCheckBox;
    chkFinanceiro: TCheckBox;
    chkDre: TCheckBox;
    chkDashboard: TCheckBox;
    chkIfood: TCheckBox;
    chkAiqfome: TCheckBox;
    chkDeliveryDireto: TCheckBox;
    chkGerenceRep: TCheckBox;

    lblValorWpp: TLabel;
    pnlTituloModulos: TPanel;
    Label2: TLabel;
    lblValorMB: TLabel;
    lblValorE: TLabel;
    lblValorFiscal: TLabel;
    lblValorGP: TLabel;
    lblValorCA: TLabel;
    lblValorFinanceiro: TLabel;
    lblValorDRE: TLabel;
    lblValorDash: TLabel;
    lblValorFood: TLabel;
    lblValorFome: TLabel;
    lblValorDD: TLabel;
    lblValorGRep: TLabel;

    Label15: TLabel;
    btnMenos: TButton;
    lblQtdTerminais: TLabel;
    btnMais: TButton;
    lblValorT: TLabel;

    procedure FormCreate(Sender: TObject);
    procedure btnMaisClick(Sender: TObject);
    procedure btnMenosClick(Sender: TObject);
    procedure CheckBoxClickGenerico(Sender: TObject);

  private

    { Declarações privadas }
    FFQuantidadeTerminais: Integer;
    const
      QTD_MINIMA = 3;          // Mínimo de 3 terminais
      VALOR_BASE = 127.00;     // Preço dos 3 primeiros
      VALOR_EXTRA = 17.00;     // Preço de cada um acima de 3

   function TextoParaValor(Texto: String): Currency;
    procedure CalcularTudo;
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}


{ --- Funções Auxiliares --- }

// Transforma texto "R$ 17,00" em número 17.00 para podermos somar
function TForm1.TextoParaValor(Texto: String): Currency;
var
  TextoLimpo: String;
begin
  // Remove R$, espaços e pontos de milhar
  TextoLimpo := StringReplace(Texto, 'R$', '', [rfReplaceAll, rfIgnoreCase]);
  TextoLimpo := StringReplace(TextoLimpo, ' ', '', [rfReplaceAll]);
  TextoLimpo := StringReplace(TextoLimpo, '.', '', [rfReplaceAll]);

  if TextoLimpo = '' then
    Result := 0
  else
    Result := StrToCurrDef(TextoLimpo, 0);
end;


// --- O MOTOR DA CALCULADORA ---
procedure TForm1.CalcularTudo;
var
  TotalGeral: Currency;
  ValorTerminal: Currency;
  Extras: Integer;
begin
  TotalGeral := 0;

  // 1. Calcula o Terminal
  if FQuantidadeTerminais <= QTD_MINIMA_TERMINAL then
    ValorTerminal := VALOR_BASE_TERMINAL
  else
  begin
    Extras := FQuantidadeTerminais - QTD_MINIMA_TERMINAL;
    ValorTerminal := VALOR_BASE_TERMINAL + (Extras * VALOR_EXTRA_TERMINAL);
  end;

// Atualiza labels do Terminal
  lblQtdTerminais.Caption := IntToStr(FQuantidadeTerminais);
  lblValorT.Caption := FormatFloat('R$ #,##0.00', ValorTerminal);

  // Adiciona terminal ao total geral
  TotalGeral := TotalGeral + ValorTerminal;

  // 2. Verifica cada CheckBox. Se marcado, soma o valor do Label correspondente
  if chkMesaEBalcao.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorMB.Caption);
  if chkEntrega.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorE.Caption);
  if chkFiscal.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorFiscal.Caption);
  if chkGerencePlus.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorGP.Caption);
  if chkWhatsapp.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorWpp.Caption);
  if chkComeraqui.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorCA.Caption);
  if chkFinanceiro.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorFinanceiro.Caption);
  if chkDre.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorDRE.Caption);
  if chkDashboard.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorDash.Caption);
  if chkIfood.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorFood.Caption);
  if chkAiqfome.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorFome.Caption);
  if chkDeliveryDireto.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorDD.Caption);
  if chkGerenceRep.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorGRep.Caption);

  // 3. Mostra o Total final no topo
  lblTotal.Caption := FormatFloat('R$ #,##0.00 | mês', TotalGeral);
end;

{ --- Eventos dos Botões e Cliques --- }

procedure TForm1.FormCreate(Sender: TObject);
begin
  // Inicia variáveis
  FQuantidadeTerminais := QTD_MINIMA_TERMINAL;
  // Faz o cálculo inicial
  CalcularTudo;
end;

procedure TForm1.btnMaisClick(Sender: TObject);
begin
  Inc(FQuantidadeTerminais); // Aumenta 1
  CalcularTudo;
end;

procedure TForm1.btnMenosClick(Sender: TObject);
begin
  if FQuantidadeTerminais > QTD_MINIMA_TERMINAL then
  begin
    Dec(FQuantidadeTerminais); // Diminui 1
    CalcularTudo;
  end;
end;

// Este evento servirá para TODOS os CheckBoxes
procedure TForm1.CheckBoxClickGenerico(Sender: TObject);
begin
  CalcularTudo;
end;

end.
