unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls;

type
  TForm1 = class(TForm)
    // --- Seus Componentes Visuais (Não mudei nada aqui) ---
    pnlHeader: TPanel;
    sbModulos: TScrollBox;
    pnlRowMesa: TPanel;
    pnlRowEntrega: TPanel;
    pnlRowFiscal: TPanel;
    pnlRowGerencePlus: TPanel;
    Panel2: TPanel;
    pnlRowComeraqui: TPanel;
    pnlRowFinanceiro: TPanel;
    pnlRowDre: TPanel;
    pnlRowDashboard: TPanel;
    pnlRowIfood: TPanel;
    pnlRowAiqfome: TPanel;
    pnlRowDeliveryDireto: TPanel;
    pnlRowGerenceRep: TPanel;
    pnlRowTerminal: TPanel;
    lblTotal: TLabel;
    chkMesaEBalcao: TCheckBox;
    chkEntrega: TCheckBox;
    chkFiscal: TCheckBox;
    chkGerencePlus: TCheckBox;
    chkWhatsapp: TCheckBox;
    chkComeraqui: TCheckBox;
    chkFinanceiro: TCheckBox;
    chkDre: TCheckBox;
    chkDashboard: TCheckBox;
    chkIfood: TCheckBox;
    chkAiqfome: TCheckBox;
    chkDeliveryDireto: TCheckBox;
    chkGerenceRep: TCheckBox;
    lblValorWpp: TLabel;
    pnlTituloModulos: TPanel;
    Label2: TLabel;
    lblValorMB: TLabel;
    lblValorE: TLabel;
    lblValorFiscal: TLabel;
    lblValorGP: TLabel;
    lblValorCA: TLabel;
    lblValorFinanceiro: TLabel;
    lblValorDRE: TLabel;
    lblValorDash: TLabel;
    lblValorFood: TLabel;
    lblValorFome: TLabel;
    lblValorDD: TLabel;
    lblValorGRep: TLabel;
    Label15: TLabel;
    btnMenos: TButton;
    lblQtdTerminais: TLabel;
    btnMais: TButton;
    lblValorT: TLabel;

    // --- Declaração dos Eventos (Procedimentos) ---
    procedure FormCreate(Sender: TObject);
    procedure btnMaisClick(Sender: TObject);
    procedure btnMenosClick(Sender: TObject);
    procedure CheckBoxClickGenerico(Sender: TObject);

  private
    { Declarações privadas CORRIGIDAS }
    FQuantidadeTerminais: Integer; // Unificado para usar este nome

    const
      QTD_MINIMA_TERMINAL = 3;       // Nome corrigido para bater com o código
      VALOR_BASE_TERMINAL = 127.00;
      VALOR_EXTRA_TERMINAL = 17.00;

    // Funções de ajuda
    function TextoParaValor(Texto: String): Currency;
    procedure CalcularTudo;
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

{ --- 1. Funções Auxiliares --- }

// Limpa o texto "R$ 17,00" para virar número
function TForm1.TextoParaValor(Texto: String): Currency;
var
  TextoLimpo: String;
begin
  TextoLimpo := StringReplace(Texto, 'R$', '', [rfReplaceAll, rfIgnoreCase]);
  TextoLimpo := StringReplace(TextoLimpo, ' ', '', [rfReplaceAll]);
  TextoLimpo := StringReplace(TextoLimpo, '.', '', [rfReplaceAll]); // Tira ponto de milhar se tiver

  if TextoLimpo = '' then
    Result := 0
  else
    Result := StrToCurrDef(TextoLimpo, 0);
end;

{ --- 2. O Cérebro (Cálculo) --- }

procedure TForm1.CalcularTudo;
var
  TotalGeral: Currency;
  ValorTerminal: Currency;
  Extras: Integer;
begin
  TotalGeral := 0;

  // A. Lógica do Terminal
  if FQuantidadeTerminais <= QTD_MINIMA_TERMINAL then
    ValorTerminal := VALOR_BASE_TERMINAL
  else
  begin
    Extras := FQuantidadeTerminais - QTD_MINIMA_TERMINAL;
    ValorTerminal := VALOR_BASE_TERMINAL + (Extras * VALOR_EXTRA_TERMINAL);
  end;

  // Atualiza os Labels do Terminal na tela
  lblQtdTerminais.Caption := IntToStr(FQuantidadeTerminais);
  lblValorT.Caption := FormatFloat('R$ #,##0.00', ValorTerminal);

  // Soma o terminal na conta final
  TotalGeral := TotalGeral + ValorTerminal;

  // B. Soma dos CheckBoxes (Lendo os Labels da tela)
  if chkMesaEBalcao.Checked    then TotalGeral := TotalGeral + TextoParaValor(lblValorMB.Caption);
  if chkEntrega.Checked        then TotalGeral := TotalGeral + TextoParaValor(lblValorE.Caption);
  if chkFiscal.Checked         then TotalGeral := TotalGeral + TextoParaValor(lblValorFiscal.Caption);
  if chkGerencePlus.Checked    then TotalGeral := TotalGeral + TextoParaValor(lblValorGP.Caption);
  if chkWhatsapp.Checked       then TotalGeral := TotalGeral + TextoParaValor(lblValorWpp.Caption);
  if chkComeraqui.Checked      then TotalGeral := TotalGeral + TextoParaValor(lblValorCA.Caption);
  if chkFinanceiro.Checked     then TotalGeral := TotalGeral + TextoParaValor(lblValorFinanceiro.Caption);
  if chkDre.Checked            then TotalGeral := TotalGeral + TextoParaValor(lblValorDRE.Caption);
  if chkDashboard.Checked      then TotalGeral := TotalGeral + TextoParaValor(lblValorDash.Caption);
  if chkIfood.Checked          then TotalGeral := TotalGeral + TextoParaValor(lblValorFood.Caption);
  if chkAiqfome.Checked        then TotalGeral := TotalGeral + TextoParaValor(lblValorFome.Caption);
  if chkDeliveryDireto.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorDD.Caption);
  if chkGerenceRep.Checked     then TotalGeral := TotalGeral + TextoParaValor(lblValorGRep.Caption);

  // C. Exibe o Total Final
  lblTotal.Caption := FormatFloat('R$ #,##0.00 | mês', TotalGeral);
end;

{ --- 3. Ações dos Botões --- }

procedure TForm1.FormCreate(Sender: TObject);
begin
  FQuantidadeTerminais := QTD_MINIMA_TERMINAL; // Começa com 3
  CalcularTudo;
end;

procedure TForm1.btnMaisClick(Sender: TObject);
begin
  Inc(FQuantidadeTerminais); // Aumenta +1
  CalcularTudo;
end;

procedure TForm1.btnMenosClick(Sender: TObject);
begin
  if FQuantidadeTerminais > QTD_MINIMA_TERMINAL then
  begin
    Dec(FQuantidadeTerminais); // Diminui -1
    CalcularTudo;
  end;
end;

// Evento genérico para todos os CheckBoxes
procedure TForm1.CheckBoxClickGenerico(Sender: TObject);
begin
  CalcularTudo;
end;

end.
