unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls;

type
  TFormPrincipal = class(TForm)

    // Componentes Visuais
    pnlHeader: TPanel;
    sbModulos: TScrollBox;
    pnlRowMesa: TPanel;
    pnlRowEntrega: TPanel;
    pnlRowFiscal: TPanel;
    pnlRowGerencePlus: TPanel;
    Panel2: TPanel;
    pnlRowComeraqui: TPanel;
    pnlRowFinanceiro: TPanel;
    pnlRowDre: TPanel;
    pnlRowDashboard: TPanel;
    pnlRowIfood: TPanel;
    pnlRowAiqfome: TPanel;
    pnlRowDeliveryDireto: TPanel;
    pnlRowGerenceRep: TPanel;
    pnlRowTerminal: TPanel;
    lblTotal: TLabel;
    chkMesaEBalcao: TCheckBox;
    chkEntrega: TCheckBox;
    chkFiscal: TCheckBox;
    chkGerencePlus: TCheckBox;
    chkWhatsapp: TCheckBox;
    chkComeraqui: TCheckBox;
    chkFinanceiro: TCheckBox;
    chkDre: TCheckBox;
    chkDashboard: TCheckBox;
    chkIfood: TCheckBox;
    chkAiqfome: TCheckBox;
    chkDeliveryDireto: TCheckBox;
    chkGerenceRep: TCheckBox;
    lblValorWpp: TLabel;
    pnlTituloModulos: TPanel;
    Label2: TLabel;
    lblValorMB: TLabel;
    lblValorE: TLabel;
    lblValorFiscal: TLabel;
    lblValorGP: TLabel;
    lblValorCA: TLabel;
    lblValorFinanceiro: TLabel;
    lblValorDRE: TLabel;
    lblValorDash: TLabel;
    lblValorFood: TLabel;
    lblValorFome: TLabel;
    lblValorDD: TLabel;
    lblValorGRep: TLabel;
    Label15: TLabel;
    btnMenos: TButton;
    lblQtdTerminais: TLabel;
    btnMais: TButton;
    lblValorT: TLabel;
    pnlContainer: TPanel;

    // Procedimentos

    procedure FormCreate(Sender: TObject);
    procedure btnMaisClick(Sender: TObject);
    procedure btnMenosClick(Sender: TObject);
    procedure CheckBoxClickGenerico(Sender: TObject);
    procedure FormResize(Sender: TObject);

  private
    { Declarações privadas }
    FQuantidadeTerminais: Integer;

    const
      QTD_MINIMA_TERMINAL = 3;
      VALOR_BASE_TERMINAL = 127.00;
      VALOR_EXTRA_TERMINAL = 17.00;

    function TextoParaValor(Texto: String): Currency;
    procedure CalcularTudo;
  public
    { Public declarations }
  end;

var
  FormPrincipal: TFormPrincipal;

implementation

{$R *.dfm}

function TFormPrincipal.TextoParaValor(Texto: String): Currency;
var
  TextoLimpo: String;
begin
  TextoLimpo := StringReplace(Texto, 'R$', '', [rfReplaceAll, rfIgnoreCase]);
  TextoLimpo := StringReplace(TextoLimpo, ' ', '', [rfReplaceAll]);
  TextoLimpo := StringReplace(TextoLimpo, '.', '', [rfReplaceAll]); // Tira ponto de milhar se tiver

  if TextoLimpo = '' then
    Result := 0
  else
    Result := StrToCurrDef(TextoLimpo, 0);
end;


procedure TFormPrincipal.CalcularTudo;
var
  TotalGeral: Currency;
  ValorTerminal: Currency;
  Extras: Integer;
begin
  TotalGeral := 0;


  if FQuantidadeTerminais <= QTD_MINIMA_TERMINAL then
    ValorTerminal := VALOR_BASE_TERMINAL
  else
  begin
    Extras := FQuantidadeTerminais - QTD_MINIMA_TERMINAL;
    ValorTerminal := VALOR_BASE_TERMINAL + (Extras * VALOR_EXTRA_TERMINAL);
  end;


  lblQtdTerminais.Caption := IntToStr(FQuantidadeTerminais);
  lblValorT.Caption := FormatFloat('R$ #,##0.00', ValorTerminal);

  TotalGeral := TotalGeral + ValorTerminal;

  if chkMesaEBalcao.Checked    then TotalGeral := TotalGeral + TextoParaValor(lblValorMB.Caption);
  if chkEntrega.Checked        then TotalGeral := TotalGeral + TextoParaValor(lblValorE.Caption);
  if chkFiscal.Checked         then TotalGeral := TotalGeral + TextoParaValor(lblValorFiscal.Caption);
  if chkGerencePlus.Checked    then TotalGeral := TotalGeral + TextoParaValor(lblValorGP.Caption);
  if chkWhatsapp.Checked       then TotalGeral := TotalGeral + TextoParaValor(lblValorWpp.Caption);
  if chkComeraqui.Checked      then TotalGeral := TotalGeral + TextoParaValor(lblValorCA.Caption);
  if chkFinanceiro.Checked     then TotalGeral := TotalGeral + TextoParaValor(lblValorFinanceiro.Caption);
  if chkDre.Checked            then TotalGeral := TotalGeral + TextoParaValor(lblValorDRE.Caption);
  if chkDashboard.Checked      then TotalGeral := TotalGeral + TextoParaValor(lblValorDash.Caption);
  if chkIfood.Checked          then TotalGeral := TotalGeral + TextoParaValor(lblValorFood.Caption);
  if chkAiqfome.Checked        then TotalGeral := TotalGeral + TextoParaValor(lblValorFome.Caption);
  if chkDeliveryDireto.Checked then TotalGeral := TotalGeral + TextoParaValor(lblValorDD.Caption);
  if chkGerenceRep.Checked     then TotalGeral := TotalGeral + TextoParaValor(lblValorGRep.Caption);

  lblTotal.Caption := FormatFloat('R$ #,##0.00 | mês', TotalGeral);
end;


procedure TFormPrincipal.FormCreate(Sender: TObject);
begin
  FQuantidadeTerminais := QTD_MINIMA_TERMINAL;
  CalcularTudo;
end;

procedure TFormPrincipal.FormResize(Sender: TObject);
begin
    if Assigned(pnlContainer) then
  begin
    pnlContainer.Left := (sbModulos.ClientWidth - pnlContainer.Width) div 2;
    pnlContainer.Top := 0;
  end;
end;

procedure TFormPrincipal.btnMaisClick(Sender: TObject);
begin
  Inc(FQuantidadeTerminais);
  CalcularTudo;
end;

procedure TFormPrincipal.btnMenosClick(Sender: TObject);
begin
  if FQuantidadeTerminais > QTD_MINIMA_TERMINAL then
  begin
    Dec(FQuantidadeTerminais);
    CalcularTudo;
  end;
end;

procedure TFormPrincipal.CheckBoxClickGenerico(Sender: TObject);
begin
  CalcularTudo;
end;

end.
